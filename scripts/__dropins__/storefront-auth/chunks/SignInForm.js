/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsx as m,jsxs as L}from"@dropins/tools/preact-jsx-runtime.js";import{Slot as O,classes as R}from"@dropins/tools/lib.js";import{c as E,g as tt,u as rt,B as $}from"./Button2.js";import{useState as y,useCallback as c,useEffect as Q,useMemo as at}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/event-bus.js";import"@dropins/tools/recaptcha.js";import{a as ot}from"./getCustomerToken.js";import{r as et}from"./resendConfirmationEmail.js";import{s as it,a as st}from"./simplifyTransformAttributesForm.js";import{f as nt,E as ut}from"./focusOnEmptyPasswordField.js";import{c as mt}from"./confirmEmail.js";import{useText as ct}from"@dropins/tools/i18n.js";import{Header as ft,InLineAlert as dt,InputPassword as lt}from"@dropins/tools/components.js";import{u as ht,F as gt}from"./Button.js";const wt=({emailConfirmationStatusMessage:t,translations:o,initialEmailValue:s,routeSignUp:l,routeForgotPassword:u,routeRedirectOnSignIn:F,onErrorCallback:_,setActiveComponent:a,onSuccessCallback:f,onSignUpLinkClick:h,handleSetInLineAlertProps:i,routeRedirectOnEmailConfirmationClose:b,apiErrorMessageOverride:A})=>{const[M,v]=y(""),[U,n]=y(!1),[g,d]=y(""),[P,w]=y(!1),[j,q]=y({userName:"",status:!1}),[V,x]=y(!1),[k,N]=y([]),p=c(async r=>{i(),n(!0),w(!1),N([]),await et(r)},[i]),D=c(r=>{r.length?w(!1):w(!0),d(r)},[]);Q(()=>{t!=null&&t.text&&i({text:t.text,type:t.status?t.status:void 0})},[t,i]);const G=c(()=>{g.length||w(!0)},[g]),B=c((r,e)=>g.length?!1:(w(!0),e&&nt(r,g,""),!0),[g]),C=c((r,e)=>{e!=null&&e.userName&&(r.target.reset(),E(F)?window.location.href=F():(f==null||f({userName:e==null?void 0:e.userName,status:!0}),q({userName:e==null?void 0:e.userName,status:!0})))},[f,F]),S=c((r,e)=>{var I;if((I=r==null?void 0:r.errorMessage)!=null&&I.length){v(e);const K=r.errorMessage.includes("This account isn't confirmed. Verify and try again."),T=K?o.resendEmailInformationText:r.displayErrorMessage;N(K?[{label:o.resendEmailButtonText,onClick:()=>{p(e)}}]:[]),i({text:T,type:"error"}),d("")}},[p,i,o.resendEmailButtonText,o.resendEmailInformationText]),H=c(async(r,e)=>{if(i(),B(r,e))return;x(!0);const I=tt(r.target);if(Object.values(I).every(T=>T)){const{email:T,password:z}=I,J=await ot({email:T,password:z,handleSetInLineAlertProps:i,onErrorCallback:_,translations:o,apiErrorMessageOverride:A});S(J,T),C(r,J),w(!1)}x(!1)},[o,_,B,S,C,i,A]),W=c(()=>{if(E(a)){a("resetPasswordForm");return}E(u)&&(window.location.href=u())},[u,a]),X=c(()=>{if(E(h)&&h(),E(a)){a("signUpForm");return}E(l)&&(window.location.href=l())},[h,l,a]),Y=at(()=>{const r=it(st);return s!=null&&s.length?r==null?void 0:r.map(e=>({...e,defaultValue:s})):r},[s]),Z=c(()=>{i(),E(b)?window.location.href=b():n(!1)},[i,b]);return{additionalActionsAlert:k,userEmail:M,defaultEnhancedEmailFields:Y,passwordError:P,isSuccessful:j,isLoading:V,signInPasswordValue:g,showEmailConfirmationForm:U,setShowEmailConfirmationForm:n,setSignInPasswordValue:d,submitLogInUser:H,forgotPasswordCallback:W,onSignUpLinkClickCallback:X,handledOnPrimaryButtonClick:Z,handleSetPassword:D,onBlurPassword:G}},yt=()=>{let t=new URL(window.location.href),o=t.searchParams.get("email"),s=t.searchParams.get("key");o&&s&&(t.searchParams.delete("email"),t.searchParams.delete("key"),window.history.replaceState({},document.title,t.toString()))},_t=({enableEmailConfirmation:t})=>{const o=ct({accountConfirmMessage:"Auth.EmailConfirmationForm.accountConfirmMessage",accountConfirmationEmailSuccessMessage:"Auth.EmailConfirmationForm.accountConfirmationEmailSuccessMessage"}),[s,l]=y({text:"",status:""});return Q(()=>{if(t){const{search:u}=window.location;u.includes("email=")&&u.includes("key=")&&(async()=>{var f,h,i;const _=new URLSearchParams(u),a=await mt({customerEmail:_.get("email"),customerConfirmationKey:_.get("key")});if(!a)return null;(f=a==null?void 0:a.errors)!=null&&f.length?l({text:a==null?void 0:a.errors[0].message,status:"error"}):(l({text:a.data.confirmEmail.customer.email?o.accountConfirmationEmailSuccessMessage.replace("{email}",(i=(h=a==null?void 0:a.data)==null?void 0:h.confirmEmail.customer)==null?void 0:i.email):o.accountConfirmMessage,status:"success"}),yt())})()}},[t,o]),{emailConfirmationStatusMessage:s}},Lt=({slots:t,labels:o,formSize:s="default",initialEmailValue:l="",renderSignUpLink:u=!1,enableEmailConfirmation:F=!1,hideCloseBtnOnEmailConfirmation:_=!1,routeRedirectOnEmailConfirmationClose:a,routeRedirectOnSignIn:f,routeForgotPassword:h,routeSignUp:i,onSuccessCallback:b,setActiveComponent:A,onErrorCallback:M,onSignUpLinkClick:v,apiErrorMessageOverride:U})=>{const n=ht({title:"Auth.SignInForm.title",buttonPrimary:"Auth.SignInForm.buttonPrimary",buttonSecondary:"Auth.SignInForm.buttonSecondary",buttonTertiary:"Auth.SignInForm.buttonTertiary",resendEmailInformationText:"Auth.Notification.resendEmailNotification.informationText",resendEmailButtonText:"Auth.Notification.resendEmailNotification.buttonText",customerTokenErrorMessage:"Auth.Api.customerTokenErrorMessage",placeholder:"Auth.InputPassword.placeholder",floatingLabel:"Auth.InputPassword.floatingLabel",requiredFieldError:"Auth.FormText.requiredFieldError.default"}),{emailConfirmationStatusMessage:g}=_t({enableEmailConfirmation:F}),{inLineAlertProps:d,handleSetInLineAlertProps:P}=rt(),{userEmail:w,additionalActionsAlert:j,defaultEnhancedEmailFields:q,passwordError:V,isSuccessful:x,isLoading:k,signInPasswordValue:N,showEmailConfirmationForm:p,submitLogInUser:D,forgotPasswordCallback:G,onSignUpLinkClickCallback:B,handledOnPrimaryButtonClick:C,handleSetPassword:S,onBlurPassword:H}=wt({translations:n,emailConfirmationStatusMessage:g,initialEmailValue:l,routeSignUp:i,routeForgotPassword:h,routeRedirectOnSignIn:f,setActiveComponent:A,onErrorCallback:M,onSuccessCallback:b,onSignUpLinkClick:v,handleSetInLineAlertProps:P,routeRedirectOnEmailConfirmationClose:a,apiErrorMessageOverride:U});return x.status&&(t!=null&&t.SuccessNotification)?m(O,{"data-testid":"successNotificationTestId",name:"SuccessNotification",slot:t==null?void 0:t.SuccessNotification,context:{isSuccessful:x}}):p?m(ut,{formSize:s,userEmail:w,inLineAlertProps:d,hideCloseBtnOnEmailConfirmation:_,handleSetInLineAlertProps:P,onPrimaryButtonClick:C}):L("div",{className:R(["auth-sign-in-form",`auth-sign-in-form--${s}`]),"data-testid":"signInForm",children:[m(ft,{title:(o==null?void 0:o.formTitleText)??n.title,divider:!1,className:"auth-sign-in-form__title"}),d.text?m(dt,{"data-testid":"authInLineAlert",className:"auth-sign-in-form__notification",type:d.type,variant:"secondary",heading:d.text,icon:d.icon,additionalActions:j}):null,L(gt,{name:"signIn_form",className:"auth-sign-in-form__form",onSubmit:D,loading:k,fieldsConfig:q,children:[m(lt,{hideStatusIndicator:!0,className:"auth-sign-in-form__form__password",autoComplete:"current-password",errorMessage:V?n.requiredFieldError:void 0,defaultValue:N,onValue:S,onBlur:H,placeholder:n.placeholder,floatingLabel:n.floatingLabel}),L("div",{className:"auth-sign-in-form__form__buttons",children:[L("div",{className:"auth-sign-in-form__form__buttons__combine",children:[m($,{type:"button",variant:"tertiary",style:{padding:0},buttonText:n.buttonTertiary,className:"auth-sign-in-form__button auth-sign-in-form__button--forgot",enableLoader:!1,onClick:G,"data-testid":"switchToSignUp"}),u?m("span",{}):null,u?m($,{type:"button",variant:"tertiary",style:{padding:0},buttonText:n.buttonSecondary,className:"auth-sign-in-form__button auth-sign-in-form__button--signup",enableLoader:!1,onClick:B}):null]}),m($,{type:"submit",buttonText:(o==null?void 0:o.primaryButtonText)??n.buttonPrimary,variant:"primary",className:"auth-sign-in-form__button auth-sign-in-form__button--submit",enableLoader:k})]})]}),m("div",{id:"generateCustomerToken"})]})};export{Lt as S};
//# sourceMappingURL=SignInForm.js.map
