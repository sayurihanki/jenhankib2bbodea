/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsx as r,jsxs as w,Fragment as z}from"@dropins/tools/preact-jsx-runtime.js";import*as U from"@dropins/tools/preact-compat.js";import{forwardRef as ae,useState as T,useEffect as J,useCallback as Tt,useImperativeHandle as ie}from"@dropins/tools/preact-compat.js";import{classes as L,VComponent as K,Slot as m}from"@dropins/tools/lib.js";import{E as ce}from"./EmptyCart2.js";/* empty css                */import{Divider as Bt,Skeleton as oe,SkeletonRow as se,InLineAlert as $t,CartList as Y,Icon as Z,Button as M,Accordion as ue,AccordionSection as de,CartItem as le,Price as X,Incrementer as me,Image as ge}from"@dropins/tools/components.js";import"@dropins/tools/preact-hooks.js";import{g as Xt}from"./persisted-data.js";import{events as Gt}from"@dropins/tools/event-bus.js";import{s as fe}from"./resetCart.js";import{a as he}from"./createGuestCart.js";import{u as qt}from"./updateProductsFromCart.js";import{S as Ft,a as ve,b as ye}from"./WarningWithCircle.js";import{S as pe}from"./ChevronDown.js";import{useText as Ce}from"@dropins/tools/i18n.js";const Ie=I=>U.createElement("svg",{id:"Icon_Chevron_right_Base","data-name":"Icon \\u2013 Chevron right \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...I},U.createElement("g",{id:"Large"},U.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),U.createElement("g",{id:"Chevron_right_icon","data-name":"Chevron right icon"},U.createElement("path",{vectorEffect:"non-scaling-stroke",id:"chevron",d:"M199.75,367.5l4.255,-4.255-4.255,-4.255",transform:"translate(-189.25 -351.0)",fill:"none",stroke:"currentColor"})))),Ut=({className:I,children:H,heading:_,footer:x,emptyCart:B,products:h,outOfStockMessage:y,variant:$="primary",loading:g=!0,...a})=>r("div",{...a,className:L(["cart-cart-summary-list",I,`cart-cart-summary-list__background--${$}`]),children:g?r(ke,{}):w(z,{children:[(_||y)&&w("div",{"data-testid":"cart-summary-list-heading-wrapper",className:L(["cart-cart-summary-list__heading",["cart-cart-summary-list__heading--full-width",!h]]),children:[_&&w(z,{children:[r(K,{node:_,className:"cart-cart-summary-list__heading-text"}),r(Bt,{variant:"primary",className:L(["cart-cart-summary-list__heading-divider"])})]}),y&&r(K,{node:y,className:"cart-cart-summary-list__out-of-stock-message"})]}),r("div",{className:L(["cart-cart-summary-list__content",["cart-cart-summary-list__content--empty",!h]]),children:h||r(K,{node:B,className:"cart-cart-summary-list__empty-cart"})}),x&&w(z,{children:[r(Bt,{variant:"primary",className:L(["cart-cart-summary-list__footer-divider"])}),r(K,{node:x,className:"cart-cart-summary-list__footer-text"})]})]})}),ke=()=>r(oe,{"data-testid":"cart-summary-list-skeleton",className:"cart-cart-summary-list__skeleton",rowGap:"medium",children:r(se,{variant:"row",size:"xlarge",fullWidth:!0,lines:3,multilineGap:"small"})}),P=I=>new DOMParser().parseFromString(I,"text/html").body.textContent||"",Se=ae(({initialData:I=null,hideHeading:H,hideFooter:_,routeProduct:x,routeEmptyCartCTA:B,routeCart:h,onItemUpdate:y,onItemRemove:$,maxItems:g,slots:a,attributesToHide:d=[],enableRemoveItem:b,enableUpdateItemQuantity:G,onItemsErrorsChange:tt,accordion:zt=!1,variant:et="primary",isLoading:Wt,showMaxItems:nt,showDiscount:rt,showSavings:at,quantityType:it,dropdownOptions:ct,undo:Q=!1,__testRecentlyRemovedItems:ot,...st},jt)=>{var Qt;const[q,Dt]=T(!I),[i,Vt]=T(I),[f,Jt]=T(new Set),[W,ut]=T(new Map),[A,O]=T(ot||[]);J(()=>{},[ot,A]);const l=(Qt=fe.config)==null?void 0:Qt.shoppingCartDisplaySetting,[E,Kt]=T(nt?!0:!g&&!nt),c=Ce({file:"Cart.CartItem.file",files:"Cart.CartItem.files",heading:"Cart.Cart.heading",message:"Cart.CartItem.message",recipient:"Cart.CartItem.recipient",regularPrice:"Cart.CartItem.regularPrice",discountedPrice:"Cart.CartItem.discountedPrice",sender:"Cart.CartItem.sender",lowInventory:"Cart.CartItem.lowInventory",insufficientQuantity:"Cart.CartItem.insufficientQuantity",insufficientQuantityGeneral:"Cart.CartItem.insufficientQuantityGeneral",outOfStockHeading:"Cart.OutOfStockMessage.heading",outOfStockDescription:"Cart.OutOfStockMessage.message",outOfStockAlert:"Cart.OutOfStockMessage.alert",removeAction:"Cart.OutOfStockMessage.action",notAvailableMessage:"Cart.CartItem.notAvailableMessage",viewMore:"Cart.Cart.viewMore",viewAll:"Cart.Cart.viewAll",discountPercent:"Cart.CartItem.discountPercentage",savingsAmount:"Cart.CartItem.savingsAmount",itemBeingRemoved:"Cart.CartItem.itemBeingRemoved",itemRemoved:"Cart.CartItem.itemRemoved",itemRemovedDescription:"Cart.CartItem.itemRemovedDescription",undoAction:"Cart.CartItem.undoAction",dismissAction:"Cart.CartItem.dismissAction",remove:"Dropin.CartItem.remove.label",removeDefault:"Dropin.CartItem.removeDefault.label",quantity:"Dropin.CartItem.quantity.label"}),R=(t,e)=>{Jt(n=>(e?n.add(t):n.delete(t),new Set(n)))},j=(t,e)=>{ut(n=>(e?n.set(t,e):n.delete(t),new Map(n)))};function Yt(t){const e=Xt(),n=e==null?void 0:e.items.find(o=>o.uid===t);n&&O(o=>{const s=e.items.findIndex(u=>u.uid===t);return s!==-1&&!o.some(u=>u.item.uid===t)?(Gt.emit("cart/product/removed",{item:n,index:s}),[...o,{item:n,index:s,error:void 0,beingRemoved:!0}]):o})}const N=(t,e)=>{R(t.uid,!0),ut(new Map),b&&e===0?(Yt(t.uid),qt([{uid:t.uid,quantity:e}]).then(()=>{$==null||$({item:t})}).finally(()=>{R(t.uid,!1),O(n=>n.map(o=>o.item.uid===t.uid?{...o,beingRemoved:!1}:o))}).catch(n=>{console.warn(n)})):G&&qt([{uid:t.uid,quantity:e}]).then(()=>{y==null||y({item:t})}).finally(()=>{R(t.uid,!1)}).catch(n=>{j(t.uid,n.message)})},dt=t=>{O(e=>e.filter(n=>n.item.uid!==t))},Zt=Tt(()=>{Kt(t=>!t)},[]);J(()=>{const t=Gt.on("cart/data",e=>{Vt(e),Dt(!!Wt)},{eager:!0});return()=>{t==null||t.off()}},[]),J(()=>{Q||O([])},[Q]),J(()=>{tt&&tt(W)},[W,tt]);const lt=(t,e)=>{if(d.includes("image"))return;const n={loading:e<4?"eager":"lazy",src:t.image.src,alt:t.image.alt,width:"300",height:"300",params:{width:300}},o=r(ge,{"data-testid":"cart-list-item-image",...n});return r(m,{name:"Thumbnail",slot:a==null?void 0:a.Thumbnail,context:{item:t,defaultImageProps:n},children:x?r("a",{href:x(t),children:o}):o})},mt=t=>{if(!d.includes("name"))return r("span",{"data-testid":"cart-list-item-title",children:x?r("a",{href:x(t),children:P(t.name)}):P(t.name)})},gt=t=>{if(d.includes("configurations"))return;const e={...t.bundleOptions,...t.selectedOptions,...t.customizableOptions,...t.recipient?{[c.recipient]:t.recipient}:null,...t.recipientEmail&&t.recipient?{[c.recipient]:`${t.recipient} (${t.recipientEmail})`}:null,...t.sender?{[c.sender]:t.sender}:null,...t.senderEmail&&t.sender?{[c.sender]:`${t.sender} (${t.senderEmail})`}:{},...t.message?{[c.message]:t.message}:null,...t.links&&t.links.count?t.links.count>1?{[c.files.replace("{count}",t.links.count.toString())]:t.links.result}:{[c.file.replace("{count}",t.links.count.toString())]:t.links.result}:null};if(Object.keys(e).length!==0)return e},ft=t=>{var e,n,o,s;return(l==null?void 0:l.price)==="INCLUDING_TAX"?t.discounted?{amount:t.regularPrice.value,currency:t.regularPrice.currency,style:{font:"inherit"},"data-testid":"including-tax-item-price"}:{amount:(e=t.taxedPrice)==null?void 0:e.value,currency:(n=t.taxedPrice)==null?void 0:n.currency,style:{font:"inherit"},"data-testid":"including-tax-item-price"}:{amount:(o=t.regularPrice)==null?void 0:o.value,currency:(s=t.regularPrice)==null?void 0:s.currency,style:{font:"inherit"},"data-testid":"regular-item-price"}},ht=t=>{var e,n;return{amount:(e=t.savingsAmount)==null?void 0:e.value,currency:(n=t.savingsAmount)==null?void 0:n.currency,style:{font:"inherit"},"data-testid":"item-savings-amount"}},vt=t=>(l==null?void 0:l.price)==="INCLUDING_EXCLUDING_TAX"?r(X,{amount:t.rowTotal.value,currency:t.rowTotal.currency,"data-testid":"excluding-tax-total","aria-label":c.regularPrice}):void 0,yt=t=>{var o,s,u,v,C,k,S,F,Et,Rt;const e={"aria-label":c.regularPrice},n=t.discounted?{}:null;return["INCLUDING_TAX","INCLUDING_EXCLUDING_TAX"].includes(l==null?void 0:l.price)?(e.amount=(o=t.rowTotalIncludingTax)==null?void 0:o.value,e.currency=(s=t.rowTotalIncludingTax)==null?void 0:s.currency,e.variant=t.discounted?"strikethrough":"default",e["data-testid"]="including-tax-item-total",n&&(e.amount=(u=t.total)==null?void 0:u.value,e.currency=(v=t.total)==null?void 0:v.currency,n.amount=(C=t.rowTotalIncludingTax)==null?void 0:C.value,n.currency=(k=t.rowTotalIncludingTax)==null?void 0:k.currency,n.sale=!0,n["aria-label"]=c.discountedPrice,n["data-testid"]="discount-total")):(e.amount=(S=t.total)==null?void 0:S.value,e.currency=(F=t.total)==null?void 0:F.currency,e.variant=t.discounted?"strikethrough":"default",e["data-testid"]="regular-item-total",n&&(n.amount=(Et=t.discountedTotal)==null?void 0:Et.value,n.currency=(Rt=t.discountedTotal)==null?void 0:Rt.currency,n.sale=!0,n["aria-label"]=c.regularPrice,n["data-testid"]="discount-total")),{totalProps:e,discountProps:n}},pt=t=>{var C,k,S;if(d.includes("warning"))return;const e=W.get(t.uid),n=(C=W.get(t.uid))==null?void 0:C.includes("The requested qty is not available"),o=f.has(t.uid),s=t.insufficientQuantity&&t.stockLevel?t.stockLevel==="noNumber"?c.insufficientQuantityGeneral:c.insufficientQuantity.replace("{inventory}",(k=t.stockLevel)==null?void 0:k.toString()).replace("{count}",t.quantity.toString()):"",u=t.lowInventory&&t.onlyXLeftInStock&&c.lowInventory.replace("{count}",(S=t.onlyXLeftInStock)==null?void 0:S.toString()),v=!t.outOfStock&&e&&n?c.notAvailableMessage:e;return!o&&(e||t.insufficientQuantity||t.lowInventory)?w("span",{"data-testid":"item-warning",children:[r(Z,{source:ve,size:"16"}),v||s||u]}):void 0},Ct=t=>d!=null&&d.includes("alert")?void 0:!f.has(t.uid)&&t.outOfStock?w("span",{"data-testid":"item-alert",children:[r(Z,{source:Ft,size:"16"}),c.outOfStockAlert]}):void 0,It=t=>r(m,{name:"ProductAttributes",slot:a==null?void 0:a.ProductAttributes,context:{item:t}}),kt=t=>{if(!d.includes("sku"))return r("span",{"data-testid":"cart-list-item-sku",children:t.sku})},St=t=>r(m,{name:"Footer",slot:a==null?void 0:a.Footer,context:{item:t,handleItemsLoading:R,handleItemsError:j,onItemUpdate:y}}),wt=t=>r(m,{name:"RowTotalFooter",slot:a==null?void 0:a.RowTotalFooter,context:{item:t}}),Mt=t=>{var e;if(b)return r(m,{name:"ItemRemoveAction",slot:a==null?void 0:a.ItemRemoveAction,context:{item:t,enableRemoveItem:b,handleItemQuantityUpdate:N,handleItemsError:j,handleItemsLoading:R,onItemUpdate:y,itemsLoading:f},children:r(M,{"data-testid":"cart-item-remove-button",className:L(["dropin-cart-item__remove"]),variant:"tertiary",onClick:()=>N(t,0),disabled:f.has(t.uid),icon:r(Z,{"data-testid":"cart-item-remove-icon",source:ye,size:"24",stroke:"2",viewBox:"0 0 24 24","aria-label":((e=c.remove)==null?void 0:e.replace("{product}",P(t.name)))||c.removeDefault})})})},Ht=t=>{if(!d.includes("quantity")&&G)return r(m,{name:"ItemQuantity",slot:a==null?void 0:a.ItemQuantity,context:{item:t,enableUpdateItemQuantity:G,handleItemQuantityUpdate:N,itemsLoading:f,handleItemsError:j,handleItemsLoading:R,onItemUpdate:y},children:r(me,{value:t.quantity,min:1,onValue:e=>N(t,Number(e)),name:"quantity",disabled:f.has(t.uid),"aria-label":c.quantity})})},_t=t=>i!=null&&i.totalQuantity?i.items.filter(t).map((e,n)=>{var v;const{totalProps:o,discountProps:s}=yt(e),u=r(le,{updating:f==null?void 0:f.has(e.uid),loading:q,"data-testid":`cart-list-item-entry-${e.uid}`,image:lt(e,n),title:r(m,{name:"ItemTitle",slot:a==null?void 0:a.ItemTitle,context:{item:e},children:mt(e)}),sku:d.includes("sku")?void 0:r(m,{name:"ItemSku",slot:a==null?void 0:a.ItemSku,context:{item:e},children:kt(e)}),price:d.includes("price")?void 0:r(m,{name:"ItemPrice",slot:a==null?void 0:a.ItemPrice,context:{item:e},slotTag:"span",children:r(X,{...ft(e)})}),quantity:d.includes("quantity")?void 0:e.quantity,quantityContent:Ht(e),total:w(z,{children:[d.includes("total")?void 0:r(m,{name:"ItemTotal",slot:a==null?void 0:a.ItemTotal,context:{item:e},children:r(X,{...o})}),d.includes("totalDiscount")?void 0:s&&r(m,{name:"ItemTotal",slot:a==null?void 0:a.ItemTotal,context:{item:e},children:r(X,{...s})})]}),attributes:It(e),configurations:gt(e),totalExcludingTax:d.includes("totalExcludingTax")?void 0:vt(e),taxIncluded:(l==null?void 0:l.price)==="INCLUDING_TAX",taxExcluded:!d.includes("totalExcludingTax")&&(l==null?void 0:l.price)==="INCLUDING_EXCLUDING_TAX",warning:pt(e),alert:Ct(e),quantityType:it,dropdownOptions:ct,onQuantity:G&&!f.has(e.uid)?C=>{N(e,C)}:void 0,onRemove:b&&!f.has(e.uid)?()=>N(e,0):void 0,discount:rt&&e.discounted&&e.discountPercentage?r("div",{"data-testid":"item-discount-percent",children:c.discountPercent.replace("{discount}",((v=e.discountPercentage)==null?void 0:v.toString())??"")}):void 0,savings:at&&e.discounted&&e.savingsAmount?w("div",{children:[r("span",{children:r(X,{...ht(e)})}),"Â ",c.savingsAmount]}):void 0,rowTotalFooter:wt(e),footer:St(e),removeContent:Mt(e)},e.uid);return r(m,{name:"CartItem",slot:a==null?void 0:a.CartItem,context:{item:e,index:n,enableUpdateItemQuantity:G,enableRemoveItem:b,itemsLoading:f,loading:q,attributesToHide:d,cartTaxesConfig:l,quantityType:it,dropdownOptions:ct,showDiscount:rt,showSavings:at,dictionary:c,getImage:lt,getTitle:mt,getSku:kt,getPriceProps:ft,getTotalPriceProps:yt,getProductAttributes:It,getConfiguration:gt,getTotalExcludingTax:vt,getWarning:pt,getAlert:Ct,getRowTotalFooter:wt,getFooter:St,getSavingsAmount:ht},children:u},e.uid)}):null,xt=r(m,{name:"Heading",slot:a==null?void 0:a.Heading,context:{count:i==null?void 0:i.totalQuantity},children:r("div",{"data-testid":"default-cart-heading",children:c.heading.replace("({count})",i!=null&&i.totalQuantity?`(${i==null?void 0:i.totalQuantity.toString()})`:"")})}),te=xt.props.children.props.children,ee=()=>{const t=i==null?void 0:i.items.filter(e=>e.outOfStock);t==null||t.forEach(e=>{N(e,0)})},ne=_t(t=>t.outOfStock||t.insufficientQuantity||!1),At=i!=null&&i.hasOutOfStockItems?r($t,{"data-testid":"cart-out-of-stock-message",icon:r(Z,{source:Ft,size:"16"}),itemList:r(Y,{"data-testid":"out-of-stock-cart-items",children:ne}),type:"warning",heading:c.outOfStockHeading,description:c.outOfStockDescription,variant:"primary",actionButtonPosition:"bottom",additionalActions:i!=null&&i.hasFullyOutOfStockItems&&b?[{label:c.removeAction,onClick:ee}]:void 0}):void 0,p=_t(t=>!t.outOfStock&&!t.insufficientQuantity),Ot=E?Math.max(g||5,5):Math.min((i==null?void 0:i.totalQuantity)||5,5),Nt=(i==null?void 0:i.totalQuantity)>Ot,re=Nt&&!E&&Ot!=g,D=i!=null&&i.totalQuantity&&p?r(m,{name:"Footer",slot:a==null?void 0:a.CartSummaryFooter,context:{displayMaxItems:E,routeCart:h},"data-testid":"cart-cart-summary-footer-slot",className:"cart-cart-summary-footer",children:Nt?re?r(M,{className:"cart-cart-summary-list-footer__action",onClick:Zt,"data-testid":"view-more-items-button",variant:"tertiary",children:c.viewMore}):h&&r(M,{className:"cart-cart-summary-list-footer__action",href:h(),variant:"tertiary","data-testid":"view-cart-or-less-items-button",children:c.viewAll}):h&&r(M,{className:"cart-cart-summary-list-footer__action",href:h(),variant:"tertiary","data-testid":"view-cart-button",children:c.viewAll})}):null,Pt=()=>{if(!(i!=null&&i.items))return null;const t=[],e=i.items,n=a==null?void 0:a.UndoBanner,o=E?Math.max(g||(i==null?void 0:i.totalQuantity),5):Math.min(g??5,5);for(let s=0;s<=o;s++)Q&&A.filter(u=>u.index===s).forEach(({item:u,error:v,beingRemoved:C})=>{var S,F;const k=r($t,{type:v?"error":"info",heading:C?(S=c.itemBeingRemoved)==null?void 0:S.replace("{product}",P(u.name)):(F=c.itemRemoved)==null?void 0:F.replace("{product}",P(u.name)),description:v||c.itemRemovedDescription,variant:"primary",actionButtonPosition:"bottom",additionalActions:C?[]:[{label:c.undoAction,onClick:()=>V(u.uid),"aria-label":`${c.undoAction} remove ${P(u.name)}`},{label:c.dismissAction,onClick:()=>dt(u.uid),"aria-label":`${c.dismissAction} undo for ${P(u.name)}`}]},`undo-banner-${u.uid}`);t.push(n?r(m,{name:"UndoBanner",slot:n,context:{item:u,loading:q,error:v,onUndo:()=>V(u.uid),onDismiss:()=>dt(u.uid)},children:k},`undo-banner-${u.uid}`):k)}),s<o&&s<e.length&&t.push((p==null?void 0:p[s])||null);return r(Y,{"data-testid":"cart-list",children:t})},V=Tt(async t=>{O(n=>n.map(o=>o.item.uid===t?{...o,loading:!0,error:void 0}:o));const e=A.find(n=>n.item.uid===t);if(e)try{await he([{sku:e.item.sku,parentSku:e.item.topLevelSku,quantity:e.item.quantity,optionsUIDs:e.item.bundleOptionsUIDs||(e.item.selectedOptionsUIDs?Object.values(e.item.selectedOptionsUIDs):void 0),enteredOptions:e.item.customizableOptions?Object.entries(e.item.customizableOptions).map(([n,o])=>({uid:n,value:o})):void 0}]),O(n=>n.filter(o=>o.item.uid!==t))}catch(n){O(o=>o.map(s=>s.item.uid===t?{...s,error:(n==null?void 0:n.message)||"Failed to restore item."}:s))}},[A]);ie(jt,()=>({handleUndo:V}),[V]);const Lt=r(z,{children:Q&&A.length>0?Pt():r(m,{name:"EmptyCart",slot:a==null?void 0:a.EmptyCart,context:{},children:r(ce,{"data-testid":"empty-cart",ctaLinkURL:B==null?void 0:B()})})}),bt=i!=null&&i.totalQuantity||Q&&A.length>0?Q?A.length>0?Pt():r(Y,{"data-testid":"cart-list",children:p==null?void 0:p.slice(0,E?Math.max(g||(i==null?void 0:i.totalQuantity),5):Math.min(g??5,5))}):r(Y,{"data-testid":"cart-list",children:p==null?void 0:p.slice(0,E?Math.max(g||(i==null?void 0:i.totalQuantity),5):Math.min(g??5,5))}):null;return zt?r(ue,{"data-testid":"cart-summary-list-accordion",className:L(["cart-cart-summary-list-accordion",`cart-cart-summary-list__background--${et}`]),iconOpen:Ie,iconClose:pe,children:r(de,{title:te,"data-testid":"cart-summary-list-accordion__section",open:!0,renderContentWhenClosed:!0,children:r(Ut,{...st,"aria-expanded":!0,"aria-label":"TEST",className:"cart-cart-summary-list-accordion__list",loading:q,footer:_?void 0:D||(h?D:void 0),emptyCart:Lt,products:bt,outOfStockMessage:At,variant:et})})}):r(Ut,{...st,heading:H?void 0:xt,footer:_?void 0:D||(h?D:void 0),loading:q,emptyCart:Lt,products:bt,outOfStockMessage:At,variant:et})});Se.getInitialData=async function(){return Xt()};export{Se as C};
//# sourceMappingURL=CartSummaryList.js.map
