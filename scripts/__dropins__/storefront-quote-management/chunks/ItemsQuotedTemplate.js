/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsx as n,jsxs as ie,Fragment as le}from"@dropins/tools/preact-jsx-runtime.js";import{useState as d,useEffect as O,useCallback as u}from"@dropins/tools/preact-compat.js";import{Slot as Y}from"@dropins/tools/lib.js";import{events as H}from"@dropins/tools/event-bus.js";import{InLineAlert as B,Price as $}from"@dropins/tools/components.js";/* empty css                      */import{I as z,Q as me,P as de,L as ue}from"./LineItemNoteModal.js";import{C as ce}from"./ConfirmationModal.js";/* empty css                *//* empty css                  */import"./state.js";import{r as pe,u as ge,a as Me}from"./addQuoteTemplateLineItemNote.js";import{S as G}from"./CheckWithCircle.js";import{S as U}from"./WarningFilled.js";import{useText as fe}from"@dropins/tools/i18n.js";const ve=3e3,Te=S=>{const{templateId:r,onRemoveModalStateChange:a,removeSuccessMessage:e,removeErrorMessage:T}=S,[i,g]=d(!1),[M,l]=d([]),[m,o]=d(!1),[I,s]=d({type:null,message:""});O(()=>{const c=H.on("quote-management/quote-template-data",()=>{l([]),o(!1),s({type:"success",message:e}),setTimeout(()=>{g(!1),s({type:null,message:""}),a==null||a(!1)},ve)});return()=>c==null?void 0:c.off()},[e,a]);const N=u(c=>{!c||c.length===0||(l(c),s({type:null,message:""}),g(!0))},[]),Q=u(async()=>{if(!r||M.length===0)return;const c=M.map(y=>y.uid).filter(Boolean);if(c.length!==0){o(!0),s({type:null,message:""});try{await pe({templateId:r,itemUids:c})}catch(y){const p=y instanceof Error?y.message:T;s({type:"error",message:p}),o(!1)}}},[r,M,T]),t=u(()=>{g(!1),s({type:null,message:""}),a==null||a(!1),l([])},[a]);return{handleRemoveItems:N,handleConfirmRemove:Q,handleCancelRemove:t,isRemoveModalOpen:i,itemsToRemove:M,isRemoving:m,removeNotificationState:I}},Ie=S=>{const{handleRemoveItems:r}=S,[a,e]=d({}),T=u(()=>{},[]),i=u(M=>{const l=M.uid||"";e(m=>{if(!(l in m))return m;const o={...m};return delete o[l],o})},[]),g=u((M,l)=>{const m=M;if(l==="remove"){e(o=>({...o,[m.uid||""]:l})),r([m]);return}e(o=>{if(!m.uid||!(m.uid in o))return o;const I={...o};return delete I[m.uid],I})},[r]);return{dropdownSelections:a,handleItemDropdownChange:g,handleDismissRemoveBanner:T,clearDropdownSelection:i}},ye=3e3,he=S=>{const{templateId:r,onUpdateModalStateChange:a,updateSuccessMessage:e,updateErrorMessage:T}=S,[i,g]=d({}),[M,l]=d(!1),[m,o]=d(!1),[I,s]=d({type:null,message:""});O(()=>{const p=H.on("quote-management/quote-template-data",()=>{g({}),o(!1),s({type:"success",message:e}),setTimeout(()=>{l(!1),s({type:null,message:""}),a==null||a(!1)},ye)});return()=>p==null?void 0:p.off()},[e,a]);const N=u((p,h)=>{const b=p;if(!b.uid)return;const C=b.uid;g(E=>({...E,[C]:h}))},[]),Q=u(p=>{p.preventDefault(),s({type:null,message:""}),l(!0)},[]),t=u(async()=>{if(!r||Object.keys(i).length===0){l(!1);return}o(!0),s({type:null,message:""});const p=Object.entries(i).map(([h,b])=>({itemId:h,quantity:b}));try{await ge({templateId:r,items:p})}catch(h){const b=h instanceof Error?h.message:T;s({type:"error",message:b}),o(!1)}},[r,i,T]),c=u(()=>{l(!1),s({type:null,message:""}),a==null||a(!1),g({})},[a]),y=u(()=>{s({type:null,message:""})},[]);return{quantityChanges:i,handleQuantityChange:N,handleUpdate:Q,handleConfirmUpdate:t,handleCancelUpdate:c,handleDismissBanner:y,isUpdateModalOpen:M,isUpdating:m,updateNotificationState:I}},qe=({templateData:S,slots:r,...a})=>{const[e,T]=d(S),[i,g]=d(null),[M,l]=d(!1),[m,o]=d(!1),[I,s]=d(""),[N,Q]=d({}),t=fe({subtotal:"NegotiableQuoteTemplate.Manage.quotePricesSummary.subtotal.excludingTax",grandTotal:"NegotiableQuoteTemplate.Manage.quotePricesSummary.grandTotal.includingTax",appliedTaxes:"NegotiableQuoteTemplate.Manage.quotePricesSummary.appliedTaxes",removeModalTitle:"NegotiableQuoteTemplate.Manage.removeItemsModal.title",removeModalDescription:"NegotiableQuoteTemplate.Manage.removeItemsModal.description",removeModalCancelButton:"NegotiableQuoteTemplate.Manage.removeItemsModal.cancelButton",removeModalConfirmButton:"NegotiableQuoteTemplate.Manage.removeItemsModal.confirmButton",removeModalConfirmButtonRemoving:"NegotiableQuoteTemplate.Manage.removeItemsModal.confirmButtonRemoving",removeSuccessHeading:"NegotiableQuoteTemplate.Manage.removeItemsModal.successHeading",removeSuccessMessage:"NegotiableQuoteTemplate.Manage.removeItemsModal.successMessage",removeErrorHeading:"NegotiableQuoteTemplate.Manage.removeItemsModal.errorHeading",removeErrorMessage:"NegotiableQuoteTemplate.Manage.removeItemsModal.errorMessage",updateModalTitle:"NegotiableQuoteTemplate.Manage.updateQuantitiesModal.title",updateModalDescription:"NegotiableQuoteTemplate.Manage.updateQuantitiesModal.description",updateModalCancelButton:"NegotiableQuoteTemplate.Manage.updateQuantitiesModal.cancelButton",updateModalUpdateButton:"NegotiableQuoteTemplate.Manage.updateQuantitiesModal.updateButton",updateSuccessHeading:"NegotiableQuoteTemplate.Manage.updateQuantitiesModal.successHeading",updateSuccessMessage:"NegotiableQuoteTemplate.Manage.updateQuantitiesModal.successMessage",updateErrorHeading:"NegotiableQuoteTemplate.Manage.updateQuantitiesModal.errorHeading",updateErrorMessage:"NegotiableQuoteTemplate.Manage.updateQuantitiesModal.errorMessage",errorHeading:"NegotiableQuoteTemplate.Manage.lineItemNoteModal.errorHeading"}),{handleRemoveItems:c,handleConfirmRemove:y,handleCancelRemove:p,isRemoveModalOpen:h,isRemoving:b,removeNotificationState:C,itemsToRemove:E}=Te({templateId:e==null?void 0:e.id,removeSuccessMessage:t.removeSuccessMessage,removeErrorMessage:t.removeErrorMessage}),{dropdownSelections:J,handleItemDropdownChange:P,handleDismissRemoveBanner:q,clearDropdownSelection:L}=Ie({handleRemoveItems:c}),{handleQuantityChange:A,handleUpdate:F,handleConfirmUpdate:K,handleCancelUpdate:V,handleDismissBanner:k,isUpdateModalOpen:X,updateNotificationState:D}=he({templateId:e==null?void 0:e.id,updateSuccessMessage:t.updateSuccessMessage,updateErrorMessage:t.updateErrorMessage});O(()=>{const f=H.on("quote-management/quote-template-data",v=>{T(v.quoteTemplate),Q({})},{eager:!0});return()=>f==null?void 0:f.off()},[]);const Z=u(()=>{E.forEach(f=>{L(f)}),p()},[E,L,p]),_=u((f,v)=>{const R=f;if(v==="edit"){g(R),l(!0),Q(re=>({...re,[R.uid]:v}));return}P(f,v)},[P]),j={...J,...N},w=u(()=>{i&&Q(f=>{const v={...f};return delete v[i.uid],v}),l(!1),g(null),o(!1),s("")},[i]),ee=u(async f=>{if(!(!i||!e)){o(!0),s("");try{await Me({templateId:e.id,itemId:i.uid,note:f}),w()}catch(v){console.error("Failed to set template line item note:",v);const R=v instanceof Error?v.message:"Unable to update the item. Please try again.";s(R),o(!1)}}},[i,e,w]),te=C.type==="success"?n(B,{type:"success",variant:"primary",icon:n(G,{}),heading:t.removeSuccessHeading,description:C.message,onDismiss:q,"data-testid":"remove-items-success-banner"}):C.type==="error"?n(B,{type:"error",variant:"primary",icon:n(U,{}),heading:t.removeErrorHeading,description:C.message,onDismiss:q,"data-testid":"remove-items-error-banner"}):null,ae=D.type==="success"?n(B,{type:"success",variant:"primary",icon:n(G,{}),heading:t.updateSuccessHeading,description:D.message,onDismiss:k,"data-testid":"update-quantities-success-banner"}):D.type==="error"?n(B,{type:"error",variant:"primary",icon:n(U,{}),heading:t.updateErrorHeading,description:D.message,onDismiss:k,"data-testid":"update-quantities-error-banner"}):null;if(!e)return n(z,{loading:!0});const oe=h?{open:!0,title:t.removeModalTitle,message:t.removeModalDescription,cancelLabel:t.removeModalCancelButton,confirmLabel:b?t.removeModalConfirmButtonRemoving:t.removeModalConfirmButton,onCancel:Z,onConfirm:y,confirmationBanner:te}:null,ne=X?{open:!0,title:t.updateModalTitle,message:t.updateModalDescription,cancelLabel:t.updateModalCancelButton,confirmLabel:t.updateModalUpdateButton,onCancel:V,onConfirm:K,confirmationBanner:ae}:null,W=oe||ne,x=[];e.prices.subtotalExcludingTax&&x.push({label:t.subtotal,id:"subtotal",value:n($,{amount:e.prices.subtotalExcludingTax.value,currency:e.prices.subtotalExcludingTax.currency,weight:"normal"})}),e.prices.grandTotal&&x.push({label:t.grandTotal,id:"total",value:n($,{amount:e.prices.grandTotal.value,currency:e.prices.grandTotal.currency}),strong:!0});const se=I?n(B,{type:"error",variant:"primary",icon:n(U,{}),heading:t.errorHeading,description:I,onDismiss:()=>s(""),"data-testid":"line-item-note-error-banner"}):null;return ie(le,{children:[n(z,{"data-testid":"items-quoted-template-container",...a,loading:!1,table:n(Y,{name:"ProductListTable",slot:r==null?void 0:r.ProductListTable,context:{items:e.items,canEdit:e.canSendForReview,dropdownSelections:j,handleItemDropdownChange:_,handleQuantityChange:A,handleUpdate:F},children:n(de,{items:e.items,canEdit:e.canSendForReview,showActions:e.canEditTemplateItems,onItemDropdownChange:_,onQuantityChange:A,onUpdate:F,dropdownSelections:j})}),pricesSummary:n(Y,{name:"QuotePricesSummary",slot:r==null?void 0:r.QuotePricesSummary,context:{items:e.items,prices:e.prices},children:n(me,{entries:x})})}),W&&n(ce,{...W}),i&&n(ue,{open:M,item:i,onClose:w,onConfirm:ee,isSubmitting:m,readOnlyQuantity:!0,errorBanner:se||void 0})]})};export{qe as I};
//# sourceMappingURL=ItemsQuotedTemplate.js.map
