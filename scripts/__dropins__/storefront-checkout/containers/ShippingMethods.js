/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsxs as j,jsx as n,Fragment as X}from"@dropins/tools/preact-jsx-runtime.js";import{h as pe,n as de,o as Y}from"../chunks/fetch-graphql.js";import{classes as D,VComponent as he,Slot as me}from"@dropins/tools/lib.js";import{t as fe}from"../chunks/transform-shipping-estimate.js";import{h as I,a as ge}from"../chunks/events2.js";import{n as ke,g as P}from"../chunks/values.js";import{events as B}from"@dropins/tools/event-bus.js";import{c as ee}from"../chunks/synchronizeCheckout.js";import{s as ve}from"../chunks/setShippingMethods.js";import{W as Se}from"../chunks/ConditionalWrapper.js";/* empty css                       */import{Skeleton as Ee,SkeletonRow as H,IllustratedMessage as Ce,Icon as _e,InLineAlert as Le,RadioButton as Me,Price as T,ToggleButton as ye}from"@dropins/tools/components.js";import{s as Ae}from"../chunks/dom.js";import{useRef as re,useEffect as R,useState as V,useCallback as p,useMemo as te}from"@dropins/tools/preact-hooks.js";import*as a from"@dropins/tools/preact-compat.js";import{useText as ne}from"@dropins/tools/i18n.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";import"../fragments.js";import"../chunks/transform-shipping-methods.js";import"../chunks/classifiers.js";import"../chunks/guards.js";const We=o=>a.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...o},a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M2.47266 4.90002H15.1851V10.9645H21.2495L23 12.715V17.6124H20.073",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M15.1758 5.87573H19.0019L21.0394 10.7636",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M9.76151 16.7898C9.76151 18.0525 8.72845 19.076 7.46582 19.076C6.20318 19.076 5.17969 18.0429 5.17969 16.7803C5.17969 15.5176 6.20318 14.4941 7.46582 14.4941C8.72845 14.4941 9.75195 15.5176 9.76151 16.7803C9.76151 16.7803 9.76151 16.7803 9.76151 16.7898Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.8726 16.7898C19.8726 18.062 18.8491 19.0855 17.5769 19.0855C16.3047 19.0855 15.2812 18.062 15.2812 16.7898C15.2812 15.5176 16.3047 14.4941 17.5769 14.4941C18.8491 14.4941 19.8726 15.5176 19.8726 16.7898Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M8.08792 7.63574H1.69824",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M7.11229 10.3619H1",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M5.16084 13.0402H1.92773",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M9.76172 16.7611H15.2809",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M2.38672 16.7611H5.17025",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"})),je=()=>j(Ee,{"data-testid":"shipping-methods-skeleton",children:[n(H,{size:"small",variant:"heading"}),n(H,{size:"small",variant:"empty"}),n(H,{fullWidth:!0,size:"medium"}),n(H,{fullWidth:!0,size:"medium"})]}),Be=({className:o,busy:i=!1,onSelectionChange:g=()=>{},options:v,selection:d,title:l,UIComponentType:u="RadioButton",error:h=null,onDismissError:b=()=>{},...U})=>{const S=ne({EmptyState:"Checkout.ShippingMethods.emptyState"}),E=h!==null,C=re(null);R(()=>{E&&C.current&&Ae(C.current)},[E]);const _=(r,x)=>{const L={busy:i,className:"checkout-shipping-methods__method",key:r.value,name:"shipping-method",value:r.value,onChange:()=>g(r)};return x==="RadioButton"?n(Me,{...L,checked:(d==null?void 0:d.value)===r.value,"data-testid":"shipping-method-radioButton",description:r.title,disabled:i,id:r.value,label:j(X,{children:[r.originalAmount&&n(T,{amount:r.originalAmount.value,className:"checkout-shipping-methods__price--original",currency:r.originalAmount.currency,"data-testid":"shipping-method-original-price",variant:"strikethrough"}),n(T,{amount:r.amount.value,className:"checkout-shipping-methods__price",currency:r.amount.currency}),"Â ",n("span",{children:r.carrier.title})]})}):n(ye,{...L,"data-testid":"shipping-method-toggleButton",label:j(X,{children:[n("span",{children:r.carrier.title}),j("div",{className:"checkout-shipping-methods__price-wrapper",children:[r.originalAmount&&n(T,{amount:r.originalAmount.value,className:"checkout-shipping-methods__price--original",currency:r.originalAmount.currency,"data-testid":"shipping-method-original-price",variant:"strikethrough"}),n(T,{amount:r.amount.value,className:"checkout-shipping-methods__price",currency:r.amount.currency})]})]}),selected:(d==null?void 0:d.value)===r.value})};return j("div",{...U,className:D(["checkout-shipping-methods",o]),"data-testid":"checkout-shipping-methods",children:[l&&n(he,{className:"checkout-shipping-methods__title",node:l}),n("div",{className:D(["checkout-shipping-methods__content"]),children:n("div",{className:D(["checkout-shipping-methods__options",["checkout-shipping-methods__options--busy",i],["checkout-shipping-methods__options--toggleButton",u==="ToggleButton"]]),"data-testid":"checkout-shipping-methods-options",children:v.length===0?n(Ce,{"data-testid":"checkout-shipping-methods-empty",icon:n(_e,{source:We}),message:n("p",{children:S.EmptyState})}):v.map(r=>_(r,u))})}),E&&n("div",{ref:C,className:"checkout-shipping-methods__error","data-testid":"checkout-shipping-methods-alert",children:n(Le,{heading:h,type:"error",variant:"primary",onDismiss:b})})]})},Ne=Se(Be,je);function Q(o,i){return o?i.some(g=>Z(g,o)):!1}function Z(o,i){return!o||!i||o.amount.value!==i.amount.value?!1:o.code===i.code&&o.carrier.code===i.carrier.code}function Oe(o){const i=B.lastPayload("shipping/estimate");i&&B.emit("shipping/estimate",{...i,shippingMethod:fe(o)})}const Ye=({UIComponentType:o="RadioButton",active:i=!0,autoSync:g=!0,displayTitle:v=!0,initialData:d,slots:l,onCartSyncError:u,onSelectionChange:h,...b})=>{const[U,S]=V(null),[E,C]=V(!1),[_,r]=V(),[x,L]=V(null),N=re(null),ie=pe.value,oe=de.value,{cartSyncError:q,defaultTitle:F}=ne({cartSyncError:"Checkout.ShippingMethods.cartSyncError",defaultTitle:"Checkout.ShippingMethods.title"}),O=p(e=>{if(!e||e.length===0)return[];const{shipping:t}=ee.getConfig();return t!=null&&t.filterOptions?e.filter(t.filterOptions):e},[]),$=p(e=>{if(e.length===0)return null;const{defaults:t}=ee.getConfig();return t.selectedShippingMethod(e)},[]),se=te(()=>O(_),[_,O]),ce=p(()=>{S(null)},[]),c=p(e=>{S(null),L(t=>Z(t,e)?t:(ke({selectedShippingMethod:e}),e))},[]),M=p(async(e,t)=>{if(!g||!I())return;const s={carrierCode:e.carrier.code,methodCode:e.code};ve([s]).catch(m=>{c(t??null),u==null||u({method:e,error:m}),u||S(q)})},[g,c,u,q]),ae=p(async e=>{const t=P("selectedShippingMethod");c(e),h==null||h(e),I()||Oe(e),await M(e,t)},[h,c,M]),y=p(e=>{var K;const t=!e||e.isEmpty,s=!!(e!=null&&e.isVirtual);if(t||s){C(s),c(null),r([]);return}const m=(K=e.shippingAddresses)==null?void 0:K[0];if(!m)return;const A=m.availableShippingMethods??[];Y()&&!N.current&&(N.current=A);const J=Y()&&N.current?N.current:A;r(J);const W=O(J);if(W.length===0){c(null);return}const f=m.selectedShippingMethod??null,k=P("selectedShippingMethod"),z=Q(k,W),ue=Z(k,f);if(k&&z&&!ue){M(k,f);return}if((!k||!z)&&f&&Q(f,W)){c(f);return}if((!k||!z)&&(!f||!Q(f,W))){const w=$(W);c(w),w&&M(w)}},[O,$,c,M]),G=p(e=>{if(e===void 0)return;const{shippingMethod:t,availableShippingMethods:s}=e,m=(s==null?void 0:s.find(A=>A.code===(t==null?void 0:t.methodCode)&&A.carrier.code===(t==null?void 0:t.carrierCode)))??null;r(s),c(m)},[c]);R(()=>{if(!i)return;const e=ge();if(e){const s=P("selectedShippingMethod");s&&L(s),y(e);return}const t=B.on("checkout/initialized",y,{eager:!0});return()=>{t==null||t.off()}},[i,y]),R(()=>{if(!i)return;const e=B.on("checkout/updated",y,{eager:!1});return()=>{e==null||e.off()}},[i,y]),R(()=>{if(!i||I())return;const e=B.on("shipping/estimate",G,{eager:!0});return()=>{e==null||e.off()}},[i,G]);const le=te(()=>{if(v)return n(me,{name:"checkout-shipping-methods-title",slot:l==null?void 0:l.Title,children:n("h3",{children:F})})},[v,l==null?void 0:l.Title,F]);return n(Ne,{...b,UIComponentType:o,busy:ie||oe,error:U,initialized:_!==void 0,options:se,selection:x,title:le,visible:i&&!E,onDismissError:ce,onSelectionChange:ae})};export{Ye as ShippingMethods,Ye as default,Oe as emitShippingEstimateEvent};
//# sourceMappingURL=ShippingMethods.js.map
