/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsx as r,jsxs as u,Fragment as ce}from"@dropins/tools/preact-jsx-runtime.js";import"../chunks/fetch-graphql.js";import{VComponent as w,classes as se,Slot as M}from"@dropins/tools/lib.js";import{b as me,a as ue}from"../chunks/events2.js";import{a as A}from"../chunks/validation.js";import{n as W,g as X}from"../chunks/values.js";import{events as P}from"@dropins/tools/event-bus.js";import{i as he,s as de,g as ge}from"../chunks/setGuestEmailOnCart.js";import{Field as fe,Input as pe,Skeleton as ke,SkeletonRow as Y}from"@dropins/tools/components.js";import{useText as H}from"@dropins/tools/i18n.js";import"../chunks/TermsAndConditions.js";/* empty css                             */import{W as Le}from"../chunks/ConditionalWrapper.js";import"@dropins/tools/preact-compat.js";/* empty css                        *//* empty css                  *//* empty css                       */import{useState as k,useRef as ve,useCallback as d,useEffect as $,useMemo as T}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";import"../fragments.js";import"../chunks/synchronizeCheckout.js";import"../chunks/transform-shipping-methods.js";import"../chunks/classifiers.js";const Fe=({value:n,error:o,hint:l,onChange:g,onBlur:L,onInvalid:s})=>{const c=H({LoginFormLabel:"Checkout.LoginForm.ariaLabel",LoginFormFloatingLabel:"Checkout.LoginForm.floatingLabel",LoginFormPlaceholder:"Checkout.LoginForm.placeholder"});return r(fe,{error:o,hint:l,children:r(pe,{"aria-label":c.LoginFormLabel,"aria-required":!0,autocomplete:"email",floatingLabel:c.LoginFormFloatingLabel,id:"customer-email",name:"customer-email",placeholder:c.LoginFormPlaceholder,required:!0,type:"email",value:n,onBlur:L,onChange:g,onInvalid:s})})},_e=({onClick:n})=>{const o=H({account:"Checkout.LoginForm.account",signIn:"Checkout.LoginForm.signIn"});return u("div",{className:"checkout-login-form__sign-in",children:[o.account,r("a",{className:"checkout-login-form__link","data-testid":"sign-in-link",href:"#",rel:"noreferrer",target:"_blank",onClick:l=>{l.preventDefault(),n(l)},children:o.signIn})]})},be=()=>u(ke,{"data-testid":"login-form-skeleton",children:[r(Y,{fullWidth:!0,variant:"heading"}),r(Y,{fullWidth:!0,size:"medium"})]}),Ee=({className:n,customer:o,email:l,error:g,headingContent:L,hint:s,name:c,onEmailBlur:f,onEmailChange:m,onEmailInvalid:a,preferences:_,title:b,...z})=>u("div",{className:"checkout-login-form","data-testid":"checkout-login-form",children:[u("div",{className:"checkout-login-form__heading",children:[b&&r(w,{className:"checkout-login-form__title",node:b}),L&&r(w,{className:"checkout-login-form__heading-label",node:L})]}),o?u("div",{className:"checkout-login-form__customer-details",children:[r("div",{className:"checkout-login-form__customer-name",children:`${o.firstName} ${o.lastName}`}),r("div",{className:"checkout-login-form__customer-email",children:o.email})]}):r("div",{className:"checkout-login-form__content",children:u("form",{...z,noValidate:!0,className:se(["dropin-login-form__form",n]),name:c,children:[r("button",{disabled:!0,"aria-hidden":"true",style:"display: none",type:"submit"}),r(Fe,{error:g,hint:s,value:l,onBlur:f,onChange:m,onInvalid:a}),_&&r(w,{className:"checkout-login-form__preferences",node:_})]})})]}),Ce=Le(Ee,be),Ne=({onClick:n})=>{const o=H({switch:"Checkout.LoginForm.switch",signOut:"Checkout.LoginForm.signOut"});return u("p",{className:"checkout-login-form__sign-out",children:[o.switch,r("a",{className:"checkout-login-form__link",href:"#",rel:"noreferrer",target:"_blank",onClick:l=>{l.preventDefault(),n==null||n(l)},children:o.signOut})]})},Ie=1e3,Ye=({active:n=!0,autoSync:o=!0,displayHeadingContent:l=!0,displayTitle:g=!0,initialData:L,onCartSyncError:s,onSignInClick:c,onSignOutClick:f,onValidationError:m,slots:a,..._})=>{const[b,z]=k(null),[E,B]=k(""),[Z,p]=k(""),[v,S]=k(!1),[j,C]=k(!0),[ee,q]=k(!1),h=ve(null),{alreadyHaveAccountHint:O,cartSyncError:R,defaultTitle:U,fasterCheckoutHint:G,invalidEmailError:N,missingEmailError:I,signInLabel:J}=H({alreadyHaveAccountHint:"Checkout.LoginForm.emailExists.alreadyHaveAccount",cartSyncError:"Checkout.LoginForm.cartSyncError",defaultTitle:"Checkout.LoginForm.title",fasterCheckoutHint:"Checkout.LoginForm.emailExists.forFasterCheckout",invalidEmailError:"Checkout.LoginForm.invalidEmailError",missingEmailError:"Checkout.LoginForm.missingEmailError",signInLabel:"Checkout.LoginForm.emailExists.signInButton"}),x=d(e=>{!A(e)||e===me()||(he(e).then(t=>{C(t)}).catch(t=>{console.error(t),C(!0)}),o&&de(e).catch(t=>{s==null||s({email:e,error:t}),s||p(R)}))},[o,s,R]),te=d(e=>{const i=e.target.value;B(i),C(!0),p(""),h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{x(i),W({email:i}),h.current=null},Ie)},[x]),ie=d(e=>{const t=e.target,i=t.value.trim();if(A(i)){if(p(""),t.setCustomValidity(""),!h.current)return;clearTimeout(h.current),h.current=null,x(i),W({email:i});return}const Q=i===""?"missing":"invalid",V=Q==="missing"?I:N;if(m){m({email:i,message:V,type:Q});return}p(V),t.setCustomValidity(V)},[N,I,m,x]),re=d(e=>{const t=e.target,i=t.validity,D=i.valueMissing?I:N;if(!m){p(D);return}m({email:t.value,message:D,type:i.valueMissing?"missing":"invalid"})},[I,N,m]),y=d(()=>{const e=X("email")??"",t=A(e);c==null||c(t?e:"")},[c]),K=d(()=>{f==null||f()},[f]),F=d(e=>{const t=X("email")??"",i=(e==null?void 0:e.email)??"";i!==t&&(B(i),p(""),C(!0),W({email:i}))},[]);$(()=>{if(!n)return;const e=P.on("authenticated",t=>{S(t),ge().then(i=>{z(i)}).catch(console.error)},{eager:!0});return()=>{e==null||e.off()}},[n]),$(()=>{if(!n)return;const e=ue();if(e){q(!0);const i=e.email??"";i&&B(i),F(e);return}const t=P.on("checkout/initialized",i=>{q(!0),F(i)},{eager:!0});return()=>{t==null||t.off()}},[n,F]),$(()=>{if(!n)return;const e=P.on("checkout/updated",F,{eager:!1});return()=>{e==null||e.off()}},[n,F]);const ne=T(()=>{if(g)return r(M,{name:"checkout-login-form-title",slot:a==null?void 0:a.Title,children:r("h2",{children:U})})},[g,a,U]),oe=T(()=>{if(l)return r(M,{context:{authenticated:v},name:"checkout-login-form-heading-label",slot:a==null?void 0:a.Heading,children:v?r(Ne,{onClick:K}):r(_e,{onClick:y})})},[l,v,a,y,K]),ae=T(()=>j?"":u(ce,{children:[O," ",r("a",{href:"#",onClick:y,children:J})," ",G]}),[j,O,J,G,y]),le=T(()=>r(M,{context:{email:E,isEmailValid:A(E),isAuthenticated:v},name:"checkout-login-form-preferences",slot:a==null?void 0:a.Preferences}),[E,v,a]);return r(Ce,{..._,customer:b,email:E,error:Z,headingContent:oe,hint:ae,initialized:ee,preferences:le,title:ne,visible:n,onEmailBlur:ie,onEmailChange:te,onEmailInvalid:re})};export{Ye as LoginForm,Ye as default};
//# sourceMappingURL=LoginForm.js.map
