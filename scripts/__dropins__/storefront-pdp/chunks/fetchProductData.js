/*! Copyright 2026 Adobe
All Rights Reserved. */
import{merge as fe,Initializer as de}from"@dropins/tools/lib.js";import{events as q}from"@dropins/tools/event-bus.js";import{PRODUCT_FRAGMENT as se}from"../fragments.js";import{FetchGraphQL as Pe}from"@dropins/tools/fetch-graphql.js";import{s as he}from"./getProductConfigurationValues.js";import{s as ye}from"./isProductConfigurationValid.js";function Ke(e){const r=new URLSearchParams(window.location.search);Object.entries(e).forEach(([n,t])=>{t===null?r.delete(n):r.set(n,String(t))});let i=window.location.pathname;i+=`?${r.toString()}`,i+=window.location.hash,window.history.replaceState({},"",i)}function oe(){const e=new URLSearchParams(window.location.search),r={};return e.forEach((i,n)=>{r[n]=i}),r}function ge(e=1){const i=(oe()||{}).quantity;if(i){const n=parseInt(i,10);if(!isNaN(n)&&Number.isInteger(n)&&n>0)return n}return e}function we(e){var r,i,n,t,s,o,l,a,m,u,f,c;return{productId:Number(e==null?void 0:e.externalId),name:e==null?void 0:e.name,sku:(e==null?void 0:e.variantSku)||(e==null?void 0:e.sku),topLevelSku:e==null?void 0:e.sku,specialToDate:void 0,specialFromDate:void 0,newToDate:void 0,newFromDate:void 0,createdAt:void 0,updatedAt:void 0,manufacturer:void 0,countryOfManufacture:void 0,categories:void 0,productType:e==null?void 0:e.productType,pricing:{regularPrice:((i=(r=e==null?void 0:e.prices)==null?void 0:r.regular)==null?void 0:i.amount)||0,minimalPrice:(t=(n=e==null?void 0:e.prices)==null?void 0:n.final)==null?void 0:t.minimumAmount,maximalPrice:(o=(s=e==null?void 0:e.prices)==null?void 0:s.final)==null?void 0:o.maximumAmount,specialPrice:(a=(l=e==null?void 0:e.prices)==null?void 0:l.final)==null?void 0:a.amount,tierPricing:void 0,currencyCode:((u=(m=e==null?void 0:e.prices)==null?void 0:m.final)==null?void 0:u.currency)||"USD"},canonicalUrl:e==null?void 0:e.url,mainImageUrl:(c=(f=e==null?void 0:e.images)==null?void 0:f[0])==null?void 0:c.url}}const ae={PRODUCT_CONTEXT:"productContext",CHANNEL_CONTEXT:"channelContext"},Ce={PRODUCT_PAGE_VIEW:"product-page-view"};function ue(){return window.adobeDataLayer=window.adobeDataLayer||[],window.adobeDataLayer}function Te(){return{_id:"https://ns.adobe.com/xdm/channels/web",_type:"https://ns.adobe.com/xdm/channel-types/web"}}function le(e,r){const i=ue();i.push({[e]:null}),i.push({[e]:r})}function pe(){typeof window>"u"||le(ae.CHANNEL_CONTEXT,Te())}function xe(e,r){ue().push(n=>{const t=n.getState?n.getState():{};n.push({event:e,eventInfo:{...t,...r}})})}function De(e){const r=we(e);le(ae.PRODUCT_CONTEXT,r),pe(),xe(Ce.PRODUCT_PAGE_VIEW)}var H=(e=>(e.ComplexProduct="complex",e.SimpleProduct="simple",e))(H||{}),me=(e=>(e.ComplexProductView="ComplexProductView",e.SimpleProductView="SimpleProductView",e))(me||{});function K(e,r){var o,l,a,m,u,f,c,g,w,x,h,A;const i=((m=(a=(l=(o=e==null?void 0:e.options)==null?void 0:o[0])==null?void 0:l.values)==null?void 0:a[0])==null?void 0:m.__typename)==="ProductViewOptionValueProduct",n=Ue(e,i,r==null?void 0:r.preselectFirstOption),t=(e==null?void 0:e.__typename)===me.SimpleProductView?H.SimpleProduct:H.ComplexProduct,s=e?{name:e.name,sku:e.sku,isBundle:i,addToCartAllowed:e.addToCartAllowed,inStock:e.inStock,shortDescription:e.shortDescription,metaDescription:e.metaDescription,metaKeyword:e.metaKeyword,metaTitle:e.metaTitle,description:e.description,images:Se(e),prices:be(e,i,n),attributes:Ee(e),options:Oe(_e(e,i)),optionUIDs:n,url:e.url,urlKey:e.urlKey,externalId:e.externalId,externalParentId:e.externalParentId,variantSku:e.variantSku,productType:t}:null;return fe(s,((g=(c=(f=(u=_.getConfig())==null?void 0:u.models)==null?void 0:f.ProductDetails)==null?void 0:c.transformer)==null?void 0:g.call(c,e))??((A=(h=(x=(w=_.getConfig())==null?void 0:w.models)==null?void 0:x.ProductDetails)==null?void 0:h.transform)==null?void 0:A.call(h,e)))}function Oe(e){var i,n,t;if(!e)return;const r=(t=(n=(i=_.getConfig())==null?void 0:i.models)==null?void 0:n.ProductOptions)==null?void 0:t.optionsTransformer;if(!r)return e;try{return r(e)??e}catch(s){return console.error("product-transform: optionsTransformer threw an error, using original options",s),e}}function Se(e){var r,i;return(i=(r=e.images)==null?void 0:r.filter(n=>{var t;return!((t=n.roles)!=null&&t.includes("hide_from_pdp"))}))==null?void 0:i.map(n=>(n.url=n.url.replace(/^https?:/,""),n))}function Ee(e){var r,i;return(i=(r=e.attributes)==null?void 0:r.filter(({roles:n})=>(n==null?void 0:n.indexOf("visible_in_pdp"))!==-1))==null?void 0:i.map(({label:n,value:t,name:s})=>{if(s!=null&&s.startsWith("ac_"))try{let o;typeof t=="string"?o=JSON.parse(t):typeof t=="object"&&(o=t);const l=j(o);return{id:s,label:n,value:JSON.stringify(l)}}catch{return{id:s,label:n,value:t.toString().split(",").join(", ")}}return{id:s,label:n,value:t.toString().split(",").join(", ")}})}function j(e){if(Array.isArray(e))return e.map(j);if(e!==null&&typeof e=="object"){const r={};for(const[i,n]of Object.entries(e)){let t=i;i==="validation_rule"?t="validationRule":i==="min_length"?t="minLength":i==="max_length"?t="maxLength":i==="purchase_separately"&&(t="purchaseSeparately"),r[t]=j(n)}return r}return e}function _e(e,r){const{options:i,optionUIDs:n}=e;return i==null?void 0:i.map(({id:t,title:s,required:o,multi:l,values:a})=>{var f,c;const m=(f=a==null?void 0:a[0])==null?void 0:f.__typename;let u=(c=a==null?void 0:a[0])==null?void 0:c.type;return u?u=u.replace("COLOR_HEX","color").replace("TEXT","text").replace("IMAGE","image"):u="dropdown",{id:t,type:u,typename:m,label:s,required:o,multiple:l,items:r?ke(a,n):Ae(a,n,u)}})}function ke(e,r){return e==null?void 0:e.filter(({enabled:i})=>typeof i>"u"||i).map(({id:i,title:n,inStock:t,isDefault:s,product:o})=>({id:i,inStock:t,label:n,selected:(r==null?void 0:r.indexOf(i))>-1||s,value:i,product:o}))}function Ae(e,r,i){return e==null?void 0:e.map(({id:n,title:t,inStock:s,value:o})=>({id:n,inStock:s,label:t,selected:(r==null?void 0:r.indexOf(n))>-1,value:(i==null?void 0:i.toLowerCase())==="dropdown"?n:o==null?void 0:o.replace(/^https?:/,"")}))}function be(e,r,i){var A,B,W,z,J;const{price:n,priceRange:t,options:s,optionUIDs:o=i}=e;let{__typename:l}=e;function a(){var C;const y=n==null?void 0:n.regular.amount.value,d=((C=n==null?void 0:n.final)==null?void 0:C.amount.value)??(n==null?void 0:n.regular.amount.value),P=(n==null?void 0:n.regular.amount.currency)==="NONE"?"USD":n==null?void 0:n.regular.amount.currency;return[y,d,d,P]}function m(){var T,p,D,O,b,U,N,I,v,F,V,L;const y=(T=t==null?void 0:t.minimum)==null?void 0:T.final.amount.value,d=(p=t==null?void 0:t.maximum)==null?void 0:p.final.amount.value;let P;((O=(D=t==null?void 0:t.minimum)==null?void 0:D.regular)==null?void 0:O.amount.value)===((U=(b=t==null?void 0:t.maximum)==null?void 0:b.regular)==null?void 0:U.amount.value)&&(P=(I=(N=t==null?void 0:t.minimum)==null?void 0:N.regular)==null?void 0:I.amount.value);const C=((F=(v=t==null?void 0:t.minimum)==null?void 0:v.final)==null?void 0:F.amount.currency)==="NONE"?"USD":(L=(V=t==null?void 0:t.minimum)==null?void 0:V.final)==null?void 0:L.amount.currency;return[P,y,d,C]}function u(){var D,O,b,U,N,I,v,F,V,L,Y,Z,R;let y=0,d=0;s==null||s.forEach(k=>{var ee;const Q=k==null?void 0:k.values;if(Q&&Array.isArray(Q)){const E=Q.map(S=>{var G,M,te,ne;return(ne=(te=(M=(G=S==null?void 0:S.product)==null?void 0:G.price)==null?void 0:M.regular)==null?void 0:te.amount)==null?void 0:ne.value}).filter(S=>S!==void 0),$=E.length>0?Math.max(...E):0;y+=$}(ee=k==null?void 0:k.values)==null||ee.forEach(E=>{var $,S,G,M;o!=null&&o.includes(E.id)&&(d+=(M=(G=(S=($=E==null?void 0:E.product)==null?void 0:$.price)==null?void 0:S.final)==null?void 0:G.amount)==null?void 0:M.value)})});const P=(D=t==null?void 0:t.minimum)==null?void 0:D.final.amount.value,C=(O=t==null?void 0:t.maximum)==null?void 0:O.final.amount.value;let T;((U=(b=t==null?void 0:t.minimum)==null?void 0:b.regular)==null?void 0:U.amount.value)===((I=(N=t==null?void 0:t.maximum)==null?void 0:N.regular)==null?void 0:I.amount.value)&&(T=(F=(v=t==null?void 0:t.minimum)==null?void 0:v.regular)==null?void 0:F.amount.value);const p=((L=(V=t==null?void 0:t.minimum)==null?void 0:V.final)==null?void 0:L.amount.currency)==="NONE"?"USD":(Z=(Y=t==null?void 0:t.minimum)==null?void 0:Y.final)==null?void 0:Z.amount.currency;return r&&(o==null?void 0:o.length)<1?[T,P,C,p]:y===((R=t==null?void 0:t.maximum)==null?void 0:R.regular.amount.value)?[d,d,d,p]:[T,P,C,p]}const[f,c,g,w]=l==="SimpleProductView"?a():r?u():m(),x=l==="SimpleProductView"?(A=n==null?void 0:n.roles)==null?void 0:A.includes("visible"):((W=(B=t==null?void 0:t.maximum)==null?void 0:B.roles)==null?void 0:W.includes("visible"))&&((J=(z=t==null?void 0:t.minimum)==null?void 0:z.roles)==null?void 0:J.includes("visible"));function h(y){return!y||!Array.isArray(y)?[]:y.map(d=>{var P,C,T,p,D,O;return{tier:{amount:(C=(P=d.tier)==null?void 0:P.amount)==null?void 0:C.value,currency:((p=(T=d.tier)==null?void 0:T.amount)==null?void 0:p.currency)||w},quantity:((D=d.quantity[0])==null?void 0:D.gte)||((O=d.quantity[0])==null?void 0:O.lt)||0}}).sort((d,P)=>d.quantity-P.quantity)}return g&&c===g?{regular:{amount:f,currency:w,variant:f&&c!==f?"strikethrough":"default"},final:{amount:g,currency:w,variant:"default"},tiers:h(n==null?void 0:n.tiers),visible:x}:{final:{minimumAmount:c,maximumAmount:g,currency:w},tiers:h(n==null?void 0:n.tiers),visible:x}}function Ue(e,r,i){var n;return r?((n=e==null?void 0:e.options)==null?void 0:n.map(({values:s})=>{var a,m;const o=((a=s==null?void 0:s.find(({isDefault:u})=>u))==null?void 0:a.id)??null,l=i?(m=s[0])==null?void 0:m.id:null;return o||l})).filter(s=>s!==null):e==null?void 0:e.optionUIDs}const X=new de({init:async e=>{var l,a,m;const r=(a=(l=e==null?void 0:e.models)==null?void 0:l.ProductDetails)==null?void 0:a.initialData,n=((m=(oe()||{}).optionsUIDs)==null?void 0:m.split(","))||(r==null?void 0:r.optionsUIDs),t=ge(1),o={...{defaultLocale:"en-US",globalLocale:"en-US",persistURLParams:!1,acdl:!1,optionsUIDs:n},...e};if(X.config.setConfig({...o}),o!=null&&o.sku){const u=r?K(r):await ie(o.sku,{preselectFirstOption:o.preselectFirstOption});q.emit("pdp/data",u,{scope:o.scope});const f={sku:o.sku,quantity:t,optionsUIDs:u==null?void 0:u.optionUIDs};he(()=>({...f}),{scope:o.scope}),ye(()=>{var c;return u!=null&&u.options?u.options.length===((c=u==null?void 0:u.optionUIDs)==null?void 0:c.length):!0},{scope:o.scope}),o.acdl&&u&&De(u)}},listeners:()=>[q.on("locale",async()=>{const{sku:e,scope:r}=X.config.getConfig();if(e){const i=await ie(e);q.emit("pdp/data",i,{scope:r})}})]}),_=X.config,{setEndpoint:Be,setFetchGraphQlHeader:We,removeFetchGraphQlHeader:ze,setFetchGraphQlHeaders:Je,getFetchGraphQlHeader:Ye,fetchGraphQl:ce,getConfig:Ze}=new Pe().getMethods(),Ne=`
query GET_PRODUCT_DATA($skus: [String]) {
    products(skus: $skus) {
        ...PRODUCT_FRAGMENT
    }
}

${se}
`,Ie=async(e,r,i)=>{var s;const{data:n}=await ce(Ne,{method:"GET",variables:{skus:[e]}}),t=(s=n==null?void 0:n.products)==null?void 0:s[0];return r!=null&&r.optionsUIDs&&(t.optionUIDs=r.optionsUIDs),t?i?t:K(t,{preselectFirstOption:r==null?void 0:r.preselectFirstOption}):null},ve=`
query REFINE_PRODUCT_QUERY(
    $optionIds: [String!]!
    $sku: String!
) {
    # Refined Product
    refineProduct(
        optionIds: $optionIds 
        sku: $sku
    ) {
        ...PRODUCT_FRAGMENT
    }

    # Parent Product
    products(skus: [$sku]) {
        ...PRODUCT_FRAGMENT
    }

    # %extendedPlaceholder%
}

${se}
`;async function re(e,r){const i=Ve(r),n=Le(i,e),t=ve.replace("# %extendedPlaceholder%",n),{data:s}=await ce(t,{method:"GET",variables:{optionIds:r,sku:e}});return s}const Fe=async(e,r,i,n)=>{var g,w,x;const t=await re(e,r);if(!t)return null;let{products:s,refineProduct:o,...l}=t;const a=s==null?void 0:s[0],m=Ge(Object.values(l),a.options,i);if(i!=null&&i.length&&o===null){r=Me(m,r,i);const h=await re(e,r);o=h==null?void 0:h.refineProduct}const u={...o||a,sku:a.sku,name:a.name,externalParentId:a==null?void 0:a.externalId,options:m,optionUIDs:r,variantSku:(o==null?void 0:o.__typename)==="SimpleProductView"?o==null?void 0:o.sku:void 0},f=n?u:K(u),c=(x=(w=(g=_==null?void 0:_.getConfig())==null?void 0:g.models)==null?void 0:w.ProductDetails)==null?void 0:x.fallbackData;return c?c(a,f):f};function Ve(e){if(e.length<2)return[e];const r=[];return e.forEach(i=>{const n=[];e.forEach(t=>{i!==t&&n.push(t)}),r.push(n)}),r}function Le(e,r){return e.map((i,n)=>`
          ProductOption${n}: refineProduct(
            optionIds: [
              ${i.map(t=>`"${t}"`).join(", ")}
            ]
            sku: "${r}"
          ) {
            ... on ComplexProductView {
              options {
                ...PRODUCT_OPTION_FRAGMENT
              }
            }
          }
        `).join("")}function Ge(e,r=[],i){const n=Object.values(e).filter(s=>!!s).reduce((s,o)=>o.options?[...s,...o.options]:[...s],[]),t=new Map(r.map(s=>[s.id,s]));return n.forEach(s=>{i!=null&&i.includes(s.id)||t.set(s.id,s)}),[...t.values()]}function Me(e,r,i){const n=[];let t;return e.forEach(s=>{var o,l,a,m;i.includes(s.id)?t=((l=(o=s.values)==null?void 0:o.find(u=>r.includes(u==null?void 0:u.id)))==null?void 0:l.id)||((a=s.values[0])==null?void 0:a.id):t=(m=s.values[0])==null?void 0:m.id,n.push(t)}),n}const ie=async(e,r)=>{const{anchors:i,optionsUIDs:n}=_.getConfig(),{optionsUIDs:t=n,anchors:s=i,preselectFirstOption:o,isBundle:l,skipTransform:a}=r??{};return!l&&t&&t.length>0?await Fe(e,t,s,a):await Ie(e,{preselectFirstOption:o,optionsUIDs:t},a)};export{We as a,Je as b,_ as c,Ze as d,Ie as e,ce as f,Ye as g,Fe as h,X as i,ie as j,ge as k,Ke as l,De as p,ze as r,Be as s,K as t};
//# sourceMappingURL=fetchProductData.js.map
